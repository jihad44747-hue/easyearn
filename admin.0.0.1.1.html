<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - Earn Now</title>
  
  <!-- Firebase App (core Firebase SDK) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <!-- Firebase Firestore -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <style>
    :root {
      --primary: #6a11cb;
      --secondary: #2575fc;
      --success: #4caf50;
      --warning: #ff9800;
      --danger: #f44336;
      --light: #f8f9fa;
      --dark: #121212;
      --card-bg: #1e1e1e;
      --text: #ffffff;
      --text-light: #aaaaaa;
      --border: #333333;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Roboto', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: var(--dark);
      color: var(--text);
      line-height: 1.6;
      padding: 0;
    }
    
    .app-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }
    
    h1 {
      font-size: 28px;
      margin-bottom: 10px;
      font-weight: 700;
    }
    
    .card {
      background-color: var(--card-bg);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }
    
    .section-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
    }
    
    .section-title::before {
      content: '';
      display: inline-block;
      width: 4px;
      height: 20px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: 2px;
      margin-right: 10px;
    }
    
    .btn {
      display: inline-block;
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
    }
    
    .btn-success {
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
    }
    
    .btn-warning {
      background: linear-gradient(135deg, #ffc107, #fd7e14);
      color: white;
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #f44336, #d32f2f);
      color: white;
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .input-group {
      margin-bottom: 15px;
    }
    
    .input-label {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
      display: block;
    }
    
    input[type="text"],
    input[type="number"],
    input[type="password"] {
      width: 100%;
      padding: 12px 15px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background-color: rgba(255, 255, 255, 0.05);
      color: var(--text);
      font-size: 14px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .stats-card {
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 5px;
    }
    
    .stat-label {
      font-size: 12px;
      opacity: 0.7;
    }
    
    .admin-login-form {
      max-width: 400px;
      margin: 50px auto;
      padding: 30px;
      text-align: center;
    }
    
    .hidden-section {
      display: none;
    }
    
    .admin-controls-panel {
      display: block;
    }
    
    .form-title {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .country-search {
      position: relative;
      margin-bottom: 15px;
    }
    
    .search-icon {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
    }
    
    .country-search input {
      padding-left: 40px;
    }
    
    .country-tiers {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .tier-btn {
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .tier-high {
      background-color: rgba(76, 175, 80, 0.2);
      color: #4caf50;
    }
    
    .tier-medium {
      background-color: rgba(255, 152, 0, 0.2);
      color: #ff9800;
    }
    
    .tier-low {
      background-color: rgba(244, 67, 54, 0.2);
      color: #f44336;
    }
    
    .tier-btn.selected {
      background-color: inherit;
      color: white;
    }
    
    .tier-high.selected {
      background-color: #4caf50;
    }
    
    .tier-medium.selected {
      background-color: #ff9800;
    }
    
    .tier-low.selected {
      background-color: #f44336;
    }
    
    .countries-list {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 15px;
    }
    
    .country-item {
      padding: 8px 10px;
      border-radius: 5px;
      margin-bottom: 5px;
      cursor: pointer;
      display: flex;
      align-items: center;
    }
    
    .country-item:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }
    
    .country-item.selected {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
    }
    
    .country-checkbox {
      margin-right: 10px;
    }
    
    .selected-countries {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 10px;
    }
    
    .status-badge {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .status-pending {
      background-color: rgba(255, 152, 0, 0.2);
      color: #ff9800;
    }
    
    .status-paid {
      background-color: rgba(76, 175, 80, 0.2);
      color: #4caf50;
    }
    
    .status-rejected {
      background-color: rgba(244, 67, 54, 0.2);
      color: #f44336;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    
    th {
      font-weight: 600;
      font-size: 14px;
    }
    
    .action-btn {
      padding: 6px 10px;
      border: none;
      border-radius: 5px;
      font-size: 12px;
      cursor: pointer;
      margin-right: 5px;
    }
    
    .approve {
      background-color: rgba(76, 175, 80, 0.2);
      color: #4caf50;
    }
    
    .reject {
      background-color: rgba(255, 152, 0, 0.2);
      color: #ff9800;
    }
    
    .delete {
      background-color: rgba(244, 67, 54, 0.2);
      color: #f44336;
    }
    
    .users-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .user-item {
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      padding: 15px;
    }
    
    .user-info {
      margin-bottom: 10px;
    }
    
    .user-name {
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .user-id {
      font-size: 12px;
      opacity: 0.7;
      margin-bottom: 5px;
    }
    
    .balance-display {
      font-weight: 600;
      margin-top: 5px;
      color: var(--success);
    }
    
    .user-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    
    .blocked-user {
      opacity: 0.7;
      border-left: 4px solid var(--danger);
    }
    
    .flag-icon {
      width: 20px;
      height: 15px;
      margin-right: 5px;
      vertical-align: middle;
    }
    
    .methods-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .method-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
    }
    
    .method-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .slider {
      background-color: var(--success);
    }
    
    input:checked + .slider:before {
      transform: translateX(26px);
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 10px;
      color: white;
      font-weight: 600;
      z-index: 1000;
      display: none;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }
    
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1001;
    }
    
    .modal-content {
      background-color: var(--card-bg);
      border-radius: 15px;
      padding: 20px;
      max-width: 400px;
      width: 90%;
    }
    
    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }
    
    .balance-edit-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1001;
    }
    
    .balance-edit-content {
      background-color: var(--card-bg);
      border-radius: 15px;
      padding: 20px;
      max-width: 400px;
      width: 90%;
    }
    
    .balance-edit-input {
      width: 100%;
      padding: 12px 15px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background-color: rgba(255, 255, 255, 0.05);
      color: var(--text);
      font-size: 16px;
      margin: 15px 0;
    }
    
    .balance-edit-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    
    .firebase-loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--dark);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    
    .loading {
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 5px solid var(--secondary);
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .user-details-panel {
      margin-top: 15px;
      padding: 15px;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      font-size: 14px;
    }
    
    .user-details-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .user-status {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .status-active {
      background-color: rgba(76, 175, 80, 0.2);
      color: #4caf50;
    }
    
    .status-blocked {
      background-color: rgba(244, 67, 54, 0.2);
      color: #f44336;
    }
    
    .user-activity-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 12px;
    }
    
    .user-activity-table th,
    .user-activity-table td {
      padding: 8px;
      border-bottom: 1px solid var(--border);
    }
    
    .activity-badge {
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 10px;
      font-weight: 600;
    }
    
    .activity-ad_watch {
      background-color: rgba(106, 17, 203, 0.2);
      color: #6a11cb;
    }
    
    .user-ip {
      font-family: monospace;
    }
    
    .tier-high {
      color: #4caf50;
      font-weight: 600;
    }
    
    .tier-medium {
      color: #ff9800;
      font-weight: 600;
    }
    
    .tier-low {
      color: #f44336;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="firebase-loading" id="firebaseLoading">
    <div style="text-align: center;">
      <div class="loading"></div>
      <p>Connecting to server...</p>
    </div>
  </div>

  <div class="modal" id="deleteModal">
    <div class="modal-content">
      <h3>Delete User</h3>
      <p>Are you sure you want to delete this user? This action cannot be undone.</p>
      <div class="modal-buttons">
        <button class="btn btn-danger confirm-delete" id="confirmDelete">Delete</button>
        <button class="btn btn-primary cancel-delete" id="cancelDelete">Cancel</button>
      </div>
    </div>
  </div>

  <div class="balance-edit-modal" id="balanceEditModal">
    <div class="balance-edit-content">
      <h3>Edit User Balance</h3>
      <input type="number" class="balance-edit-input" id="balanceEditInput" step="0.01" min="0" placeholder="Enter new balance">
      <div class="balance-edit-buttons">
        <button class="btn btn-primary save-balance-btn" id="saveBalanceBtn">Save</button>
        <button class="btn btn-danger cancel-balance-btn" id="cancelBalanceBtn">Cancel</button>
      </div>
    </div>
  </div>

  <div class="app-container">
    <header>
      <h1>Earn Now - Admin Panel</h1>
      <p>Manage users, settings, and withdrawal requests</p>
    </header>

    <main>
      <div class="content-section">
        <div class="admin-login-form card" id="adminLoginForm">
          <div class="form-title">Admin Login</div>
          <div class="input-group">
            <div class="input-label">Admin Password</div>
            <input type="password" id="admin-password" placeholder="Enter admin password">
          </div>
          <button class="btn btn-primary" id="admin-login">
            <span>🔑</span> Login
          </button>
        </div>
        
        <div id="admin-controls" class="admin-controls-panel hidden-section">
          <div class="card">
            <div class="section-title">Admin Settings</div>
            
            <div class="input-group">
              <div class="input-label">Per Ad Rate (৳)</div>
              <input type="number" id="per-ad-rate" step="0.01" value="0.06" min="0.01" placeholder="Enter amount per ad">
            </div>
            
            <div class="input-group">
              <div class="input-label">Daily Ad Limit per User</div>
              <input type="number" id="daily-task-limit" value="1234" min="1" placeholder="Enter daily task limit">
            </div>
            
            <div class="stats-grid">
              <div class="stats-card">
                <div class="stat-value" id="total-users">0</div>
                <div class="stat-label">Total Users</div>
              </div>
              <div class="stats-card">
                <div class="stat-value" id="active-today">0</div>
                <div class="stat-label">Active Today</div>
              </div>
              <div class="stats-card">
                <div class="stat-value" id="total-ads-today">0</div>
                <div class="stat-label">Ads Watched Today</div>
              </div>
              <div class="stats-card">
                <div class="stat-value" id="total-clicks-today">0</div>
                <div class="stat-label">Ad Clicks Today</div>
              </div>
              <div class="stats-card">
                <div class="stat-value" id="total-withdrawals">0</div>
                <div class="stat-label">Total Withdrawals</div>
              </div>
            </div>
            
            <button class="btn btn-primary" id="save-settings">
              <span>💾</span> Save Settings
            </button>
          </div>
          
          <div class="card">
            <div class="section-title">Country Restrictions by eCPM Tier</div>
            
            <div class="country-search">
              <span class="search-icon">🔍</span>
              <input type="text" id="country-search" placeholder="Search for countries...">
            </div>
            
            <div class="country-tiers">
              <div class="tier-btn tier-high" data-tier="high">High eCPM</div>
              <div class="tier-btn tier-medium" data-tier="medium">Medium eCPM</div>
              <div class="tier-btn tier-low" data-tier="low">Low eCPM</div>
            </div>
            
            <div class="countries-list" id="countries-list"></div>
            
            <div class="input-group">
              <div class="input-label">Selected Countries</div>
              <div id="selected-countries"></div>
            </div>
          </div>
          
          <div class="card">
            <div class="section-title">Withdrawal Methods</div>
            
            <div id="methods-list" class="methods-list">
              <!-- Methods will be loaded here -->
            </div>
            
            <div class="input-group">
              <div class="input-label">Add New Method</div>
              <div style="display: flex; gap: 10px;">
                <input type="text" id="new-method-name" placeholder="Method name (e.g., Rocket)">
                <button class="btn btn-primary" id="add-method-btn">Add</button>
              </div>
            </div>
          </div>
          
          <div class="card">
            <div class="section-title">User Management</div>
            
            <div class="user-search">
              <span class="search-icon">🔍</span>
              <input type="text" id="user-search" placeholder="Search users...">
            </div>
            
            <div class="users-list" id="users-list"></div>
          </div>
          
          <div class="card">
            <div class="section-title">Withdrawal Requests</div>
            <div style="overflow-x: auto;">
              <table>
                <thead>
                  <tr>
                    <th>User Name</th><th>Username</th><th>Method</th><th>Number</th><th>Amount</th><th>Date</th><th>Status</th><th>Action</th>
                  </tr>
                </thead>
                <tbody id="withdraw-requests"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <div class="notification" id="notification"></div>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDp49URVg2ipSBuoEBGZyqWWyc29cxAleE",
      authDomain: "easy-earn-af82c.firebaseapp.com",
      projectId: "easy-earn-af82c",
      storageBucket: "easy-earn-af82c.firebasestorage.app",
      messagingSenderId: "572340074151",
      appId: "1:572340074151:web:778d58946c1163427acd82",
      measurementId: "G-3RFZSPZD9W"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    document.addEventListener("DOMContentLoaded", async () => {
      // Show loading indicator immediately
      document.getElementById("firebaseLoading").style.display = "flex";

      // Country data with eCPM tiers
      const countryData = [
        {code: "US", name: "United States", tier: "high"},
        {code: "CA", name: "Canada", tier: "high"},
        {code: "GB", name: "United Kingdom", tier: "high"},
        {code: "AU", name: "Australia", tier: "high"},
        {code: "DE", name: "Germany", tier: "high"},
        {code: "FR", name: "France", tier: "high"},
        {code: "JP", name: "Japan", tier: "high"},
        {code: "KR", name: "South Korea", tier: "high"},
        {code: "SG", name: "Singapore", tier: "high"},
        {code: "NL", name: "Netherlands", tier: "high"},
        {code: "SE", name: "Sweden", tier: "high"},
        {code: "NO", name: "Norway", tier: "high"},
        {code: "CH", name: "Switzerland", tier: "high"},
        {code: "DK", name: "Denmark", tier: "high"},
        {code: "FI", name: "Finland", tier: "high"},
        {code: "IE", name: "Ireland", tier: "high"},
        {code: "AT", name: "Austria", tier: "high"},
        {code: "BE", name: "Belgium", tier: "high"},
        {code: "NZ", name: "New Zealand", tier: "high"},
        {code: "IT", name: "Italy", tier: "medium"},
        {code: "ES", name: "Spain", tier: "medium"},
        {code: "BR", name: "Brazil", tier: "medium"},
        {code: "MX", name: "Mexico", tier: "medium"},
        {code: "PL", name: "Poland", tier: "medium"},
        {code: "RU", name: "Russia", tier: "medium"},
        {code: "TR", name: "Turkey", tier: "medium"},
        {code: "SA", name: "Saudi Arabia", tier: "medium"},
        {code: "ZA", name: "South Africa", tier: "medium"},
        {code: "AR", name: "Argentina", tier: "medium"},
        {code: "CL", name: "Chile", tier: "medium"},
        {code: "CO", name: "Colombia", tier: "medium"},
        {code: "MY", name: "Malaysia", tier: "medium"},
        {code: "TH", name: "Thailand", tier: "medium"},
        {code: "ID", name: "Indonesia", tier: "medium"},
        {code: "PH", name: "Philippines", tier: "medium"},
        {code: "VN", name: "Vietnam", tier: "medium"},
        {code: "IN", name: "India", tier: "low"},
        {code: "PK", name: "Pakistan", tier: "low"},
        {code: "BD", name: "Bangladesh", tier: "low"},
        {code: "NG", name: "Nigeria", tier: "low"},
        {code: "EG", name: "Egypt", tier: "low"},
        {code: "ET", name: "Ethiopia", tier: "low"},
        {code: "KE", name: "Kenya", tier: "low"},
        {code: "GH", name: "Ghana", tier: "low"},
        {code: "TZ", name: "Tanzania", tier: "low"},
        {code: "UG", name: "Uganda", tier: "low"},
        {code: "MM", name: "Myanmar", tier: "low"},
        {code: "KH", name: "Cambodia", tier: "low"},
        {code: "LA", name: "Laos", tier: "low"},
        {code: "NP", name: "Nepal", tier: "low"},
        {code: "LK", name: "Sri Lanka", tier: "low"}
      ];

      const adminLoginBtn = document.getElementById("admin-login");
      const adminControls = document.getElementById("admin-controls");
      const adminLoginForm = document.getElementById("adminLoginForm");
      const perAdRateInput = document.getElementById("per-ad-rate");
      const dailyTaskLimitInput = document.getElementById("daily-task-limit");
      const saveSettingsBtn = document.getElementById("save-settings");
      const withdrawRequestsTable = document.getElementById("withdraw-requests");
      const notification = document.getElementById("notification");
      const countriesList = document.getElementById("countries-list");
      const selectedCountries = document.getElementById("selected-countries");
      const countrySearch = document.getElementById("country-search");
      const tierButtons = document.querySelectorAll('.tier-btn');
      const usersList = document.getElementById("users-list");
      const userSearch = document.getElementById("user-search");
      const methodsList = document.getElementById("methods-list");
      const newMethodNameInput = document.getElementById("new-method-name");
      const addMethodBtn = document.getElementById("add-method-btn");
      const deleteModal = document.getElementById("deleteModal");
      const confirmDeleteBtn = document.getElementById("confirmDelete");
      const cancelDeleteBtn = document.getElementById("cancelDelete");
      const balanceEditModal = document.getElementById("balanceEditModal");
      const balanceEditInput = document.getElementById("balanceEditInput");
      const saveBalanceBtn = document.getElementById("saveBalanceBtn");
      const cancelBalanceBtn = document.getElementById("cancelBalanceBtn");
      
      // Stats elements
      const totalUsersEl = document.getElementById("total-users");
      const activeTodayEl = document.getElementById("active-today");
      const totalAdsTodayEl = document.getElementById("total-ads-today");
      const totalClicksTodayEl = document.getElementById("total-clicks-today");
      const totalWithdrawalsEl = document.getElementById("total-withdrawals");

      let allRequests = [];
      let allUsers = [];
      let perAdRate = 0.06;
      let dailyTaskLimit = 1234;
      let isAdminLoggedIn = false;
      let currentTierFilter = "all";
      let selectedCountryCodes = [];
      let withdrawalMethods = [];
      let userToDelete = null;
      let userToEditBalance = null;

      // Real-time listeners
      let usersUnsubscribe = null;
      let requestsUnsubscribe = null;

      // Format date as DD-MM-YYYY
      function formatWithdrawalDate(dateString) {
        if (!dateString) return 'Unknown';
        
        try {
          const dateObj = typeof dateString.toDate === 'function' ? dateString.toDate() : new Date(dateString);
          if (isNaN(dateObj.getTime())) return 'Invalid Date';
          
          const day = dateObj.getDate();
          const month = dateObj.getMonth() + 1;
          const year = dateObj.getFullYear();
          return `${day}-${month}-${year}`;
        } catch (e) {
          return 'Invalid Date';
        }
      }

      // Set up real-time listeners
      function setupRealtimeListeners() {
        // Listen for users changes
        usersUnsubscribe = db.collection("users").onSnapshot((snapshot) => {
          allUsers = [];
          snapshot.forEach(doc => {
            const userData = doc.data();
            allUsers.push({
              id: doc.id,
              name: userData.name || 'Unknown',
              username: userData.username || 'no_username',
              userId: userData.userId || doc.id,
              country: userData.country || 'Unknown',
              ip: userData.ip || 'Not available',
              balance: userData.balance || 0,
              isBlocked: userData.isBlocked || false,
              adHistory: userData.adHistory || [],
              adClickHistory: userData.adClickHistory || [],
              lastLogin: userData.lastLogin || null,
              registrationDate: userData.registrationDate || null,
              activityLog: userData.activityLog || []
            });
          });
          
          renderUsersList();
          updateStats();
        }, (error) => {
          console.error("Error listening to users:", error);
        });

        // Listen for withdrawal requests changes
        requestsUnsubscribe = db.collection("withdrawalRequests")
          .orderBy("date", "desc")
          .onSnapshot((snapshot) => {
            allRequests = [];
            snapshot.forEach(doc => {
              allRequests.push({id: doc.id, ...doc.data()});
            });
            
            updateRequestsTable();
            updateStats();
          }, (error) => {
            console.error("Error listening to withdrawal requests:", error);
          });
      }

      // Delete user functionality
      function showDeleteModal(userId) {
        userToDelete = userId;
        deleteModal.style.display = "flex";
      }

      async function deleteUser(userId) {
        try {
          await db.collection("users").doc(userId).delete();
          showNotification("User deleted successfully");
        } catch (error) {
          console.error("Error deleting user:", error);
          showNotification("Error deleting user", false);
        }
      }

      // Balance edit functionality
      function showBalanceEditModal(userId) {
        const user = allUsers.find(u => u.id === userId);
        if (!user) return;
        
        userToEditBalance = userId;
        balanceEditInput.value = user.balance || 0;
        balanceEditModal.style.display = "flex";
        balanceEditInput.focus();
        balanceEditInput.select();
      }

      async function saveUserBalance() {
        if (!userToEditBalance) return;
        
        const newBalance = parseFloat(balanceEditInput.value);
        if (!isNaN(newBalance) && newBalance >= 0) {
          // Update in Firebase
          await db.collection("users").doc(userToEditBalance).update({
            balance: newBalance
          });
          
          showNotification("Balance updated successfully");
          balanceEditModal.style.display = "none";
          userToEditBalance = null;
        } else {
          showNotification("Please enter a valid balance", false);
        }
      }

      // Event listeners for delete modal
      confirmDeleteBtn.addEventListener("click", () => {
        if (userToDelete) {
          deleteUser(userToDelete);
          deleteModal.style.display = "none";
          userToDelete = null;
        }
      });

      cancelDeleteBtn.addEventListener("click", () => {
        deleteModal.style.display = "none";
        userToDelete = null;
      });

      // Close modal when clicking outside
      deleteModal.addEventListener("click", (e) => {
        if (e.target === deleteModal) {
          deleteModal.style.display = "none";
          userToDelete = null;
        }
      });

      // Event listeners for balance edit modal
      saveBalanceBtn.addEventListener("click", () => {
        saveUserBalance();
      });

      cancelBalanceBtn.addEventListener("click", () => {
        balanceEditModal.style.display = "none";
        userToEditBalance = null;
      });

      // Close balance modal when clicking outside
      balanceEditModal.addEventListener("click", (e) => {
        if (e.target === balanceEditModal) {
          balanceEditModal.style.display = "none";
          userToEditBalance = null;
        }
      });

      // Allow pressing Enter to save balance
      balanceEditInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          saveUserBalance();
        }
      });

      async function loadSettings() {
        try {
          const settingsDoc = await db.collection("settings").doc("appSettings").get();
          if (settingsDoc.exists) {
            const settings = settingsDoc.data();
            perAdRate = settings.perAdRate || 0.06;
            dailyTaskLimit = settings.dailyTaskLimit || 1234;
          }
          
          const countrySettingsDoc = await db.collection("settings").doc("countryRestrictions").get();
          if (countrySettingsDoc.exists) {
            const countrySettings = countrySettingsDoc.data();
            selectedCountryCodes = countrySettings.allowedCountries || [];
          }
          
          const methodsDoc = await db.collection("settings").doc("withdrawalMethods").get();
          if (methodsDoc.exists) {
            withdrawalMethods = methodsDoc.data().methods || [];
          } else {
            // Default methods
            withdrawalMethods = [
              { name: "bKash", enabled: true },
              { name: "Nagad", enabled: true },
              { name: "Rocket", enabled: true },
              { name: "Banglalink", enabled: true },
              { name: "Grameenphone", enabled: true },
              { name: "Robi", enabled: true },
              { name: "Airtel", enabled: true }
            ];
          }
        } catch (error) {
          console.error("Error loading settings:", error);
        }
      }

      async function updateWithdrawalRequest(requestId, updates) {
        try {
          await db.collection("withdrawalRequests").doc(requestId).update(updates);
        } catch (error) {
          console.error("Error updating withdrawal request:", error);
        }
      }

      async function deleteWithdrawalRequest(requestId) {
        try {
          await db.collection("withdrawalRequests").doc(requestId).delete();
        } catch (error) {
          console.error("Error deleting withdrawal request:", error);
        }
      }

      async function saveSettings() {
        try {
          await db.collection("settings").doc("appSettings").set({
            perAdRate: parseFloat(perAdRateInput.value) || 0.06,
            dailyTaskLimit: parseInt(dailyTaskLimitInput.value) || 1234
          });
          
          await db.collection("settings").doc("countryRestrictions").set({
            allowedCountries: selectedCountryCodes,
            restrictionEnabled: selectedCountryCodes.length > 0
          });
          
          await db.collection("settings").doc("withdrawalMethods").set({
            methods: withdrawalMethods
          });
          
          // Update local variables
          perAdRate = parseFloat(perAdRateInput.value) || 0.06;
          dailyTaskLimit = parseInt(dailyTaskLimitInput.value) || 1234;
        } catch (error) {
          console.error("Error saving settings:", error);
          showNotification("Error saving settings", false);
        }
      }

      async function loadData() {
        // Show loading indicator
        document.getElementById("firebaseLoading").style.display = "flex";
        
        try {
          await loadSettings();
          
          // Set up real-time listeners
          setupRealtimeListeners();
          
          updateRequestsTable();
          renderCountryList();
          renderSelectedCountries();
          renderUsersList();
          renderWithdrawalMethods();
          updateStats();
          
          // Set current values in inputs
          perAdRateInput.value = perAdRate.toFixed(2);
          dailyTaskLimitInput.value = dailyTaskLimit;
        } catch (error) {
          console.error("Error loading data:", error);
          showNotification("Error loading data", false);
        } finally {
          // Hide loading indicator
          document.getElementById("firebaseLoading").style.display = "none";
        }
      }
      
      function showNotification(msg, success=true) {
        notification.textContent = msg;
        notification.style.background = success ? "#4caf50" : "#f44336";
        notification.style.display = "block";
        setTimeout(()=>notification.style.display="none",2000);
      }

      function updateRequestsTable() {
        withdrawRequestsTable.innerHTML = "";
        
        if (allRequests.length === 0) {
          withdrawRequestsTable.innerHTML = `
            <tr>
              <td colspan="8" style="text-align: center; padding: 20px; color: #666;">
                No withdrawal requests yet
              </td>
            </tr>
          `;
          return;
        }
        
        allRequests.forEach((r,i)=>{
          let row = document.createElement("tr");
          row.innerHTML = `
            <td>${r.userName || 'Unknown'}</td>
            <td>${r.userUsername || 'Unknown'}</td>
            <td>${r.method}</td>
            <td>${r.accountNumber || r.number || 'N/A'}</td>
            <td>৳${r.amount}</td>
            <td>${formatWithdrawalDate(r.date)}</td>
            <td><span class="status-badge status-${r.status}">${r.status}</span></td>
            <td>
              <button class="action-btn approve" data-id="${r.id}">✔</button>
              <button class="action-btn reject" data-id="${r.id}">✖</button>
              <button class="action-btn delete" data-id="${r.id}">❌</button>
            </td>`;
          withdrawRequestsTable.appendChild(row);
        });
        
        // Add event listeners to action buttons
        document.querySelectorAll('.approve').forEach(btn => {
          btn.addEventListener('click', async () => {
            const requestId = btn.getAttribute('data-id');
            await updateWithdrawalRequest(requestId, { status: "paid" });
            showNotification("Request approved");
          });
        });
        
        document.querySelectorAll('.reject').forEach(btn => {
          btn.addEventListener('click', async () => {
            const requestId = btn.getAttribute('data-id');
            await updateWithdrawalRequest(requestId, { status: "rejected" });
            showNotification("Request rejected");
          });
        });
        
        document.querySelectorAll('.delete').forEach(btn => {
          btn.addEventListener('click', async () => {
            const requestId = btn.getAttribute('data-id');
            await deleteWithdrawalRequest(requestId);
            showNotification("Request deleted");
          });
        });
      }

      function renderCountryList() {
        countriesList.innerHTML = "";
        
        const searchTerm = countrySearch.value.toLowerCase();
        let filteredCountries = countryData;
        
        // Filter by search term
        if (searchTerm) {
          filteredCountries = filteredCountries.filter(country => 
            country.name.toLowerCase().includes(searchTerm) || 
            country.code.toLowerCase().includes(searchTerm)
          );
        }
        
        // Filter by tier
        if (currentTierFilter !== "all") {
          filteredCountries = filteredCountries.filter(country => country.tier === currentTierFilter);
        }
        
        // Render countries
        filteredCountries.forEach(country => {
          const isSelected = selectedCountryCodes.includes(country.code);
          
          const countryItem = document.createElement("div");
          countryItem.className = `country-item ${isSelected ? "selected" : ""}`;
          countryItem.innerHTML = `
            <input type="checkbox" class="country-checkbox" data-code="${country.code}" ${isSelected ? "checked" : ""}>
            ${country.name} (${country.code}) - <span class="tier-${country.tier}">${country.tier}</span>
          `;
          
          countryItem.addEventListener("click", (e) => {
            if (e.target.type !== "checkbox") {
              const checkbox = countryItem.querySelector(".country-checkbox");
              checkbox.checked = !checkbox.checked;
              handleCountrySelection(country.code, checkbox.checked);
            }
          });
          
          const checkbox = countryItem.querySelector(".country-checkbox");
          checkbox.addEventListener("change", () => {
            handleCountrySelection(country.code, checkbox.checked);
          });
          
          countriesList.appendChild(countryItem);
        });
      }
      
      function handleCountrySelection(countryCode, isSelected) {
        if (isSelected) {
          if (!selectedCountryCodes.includes(countryCode)) {
            selectedCountryCodes.push(countryCode);
          }
        } else {
          selectedCountryCodes = selectedCountryCodes.filter(code => code !== countryCode);
        }
        
        renderSelectedCountries();
      }
      
      function renderSelectedCountries() {
        if (selectedCountryCodes.length === 0) {
          selectedCountries.innerHTML = "<div style='color: #666; padding: 10px; text-align: center;'>No countries selected</div>";
          return;
        }
        
        selectedCountries.innerHTML = "";
        selectedCountryCodes.forEach(code => {
          const country = countryData.find(c => c.code === code);
          if (country) {
            const badge = document.createElement("span");
            badge.className = "status-badge";
            badge.textContent = `${country.name} (${code})`;
            badge.style.margin = "0 5px 5px 0";
            badge.style.cursor = "pointer";
            
            badge.addEventListener("click", () => {
              selectedCountryCodes = selectedCountryCodes.filter(c => c !== code);
              renderSelectedCountries();
              renderCountryList();
            });
            
            selectedCountries.appendChild(badge);
          }
        });
      }
      
      function renderUsersList() {
        usersList.innerHTML = "";
        
        const searchTerm = userSearch.value.toLowerCase();
        let filteredUsers = allUsers;
        
        // Filter by search term
        if (searchTerm) {
          filteredUsers = filteredUsers.filter(user => 
            (user.name && user.name.toLowerCase().includes(searchTerm)) || 
            (user.username && user.username.toLowerCase().includes(searchTerm)) ||
            (user.userId && user.userId.toLowerCase().includes(searchTerm))
          );
        }
        
        if (filteredUsers.length === 0) {
          usersList.innerHTML = "<div style='color: #666; padding: 10px; text-align: center;'>No users found</div>";
          return;
        }
        
        // Render users
        filteredUsers.forEach(user => {
          const userItem = document.createElement("div");
          userItem.className = `user-item ${user.isBlocked ? "blocked-user" : ""}`;
          
          // Get country flag URL if available
          const flagUrl = user.country && user.country !== "Unknown" ? `https://flagcdn.com/w20/${user.country.toLowerCase()}.png` : '';
          
          // Calculate today's ad count and clicks
          const today = new Date().toDateString();
          const todayAds = user.adHistory ? user.adHistory.filter(ad => {
            const adDate = new Date(ad.date).toDateString();
            return adDate === today;
          }).length : 0;
          
          const todayClicks = user.adClickHistory ? user.adClickHistory.filter(click => {
            const clickDate = new Date(click.date).toDateString();
            return clickDate === today;
          }).length : 0;
          
          userItem.innerHTML = `
            <div class="user-info">
              <div class="user-name">${user.name} ${user.isBlocked ? '🔴' : '🟢'}</div>
              <div class="user-id">@${user.username} | ${user.userId}</div>
              ${user.country && user.country !== "Unknown" ? `<div><img src="${flagUrl}" class="flag-icon" alt="${user.country}"> ${user.country}</div>` : '<div>Country: Not detected</div>'}
              <div style="font-size: 12px; color: #666;">Watched: <strong>${todayAds}</strong>/${dailyTaskLimit}</div>
              <div style="font-size: 12px; color: #666;">Clicks: <strong>${todayClicks}</strong></div>
              <div style="font-size: 12px; color: #666;">IP: ${user.ip}</div>
              <div class="balance-display">Balance: ৳${(user.balance || 0).toFixed(2)}</div>
            </div>
            <div class="user-actions">
              <button class="action-btn approve edit-balance-btn" data-user="${user.id}">💰 Edit Balance</button>
              ${user.isBlocked ? 
                `<button class="action-btn unblock-btn unblock-user" data-user="${user.id}">Unblock</button>` : 
                `<button class="action-btn block-btn block-user" data-user="${user.id}">Block</button>`
              }
              <button class="action-btn view-details" data-user="${user.id}">👁️ Details</button>
              <button class="action-btn delete-user-btn delete-user" data-user="${user.id}">🗑️ Delete</button>
            </div>
          `;
          
          usersList.appendChild(userItem);
        });
        
        // Add event listeners to edit balance buttons
        document.querySelectorAll('.edit-balance-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const userId = btn.getAttribute('data-user');
            showBalanceEditModal(userId);
          });
        });
        
        // Add event listeners to block buttons
        document.querySelectorAll('.block-user').forEach(btn => {
          btn.addEventListener('click', async () => {
            const userId = btn.getAttribute('data-user');
            await blockUser(userId, true);
          });
        });
        
        // Add event listeners to unblock buttons
        document.querySelectorAll('.unblock-user').forEach(btn => {
          btn.addEventListener('click', async () => {
            const userId = btn.getAttribute('data-user');
            await blockUser(userId, false);
          });
        });
        
        // Add event listeners to view details buttons
        document.querySelectorAll('.view-details').forEach(btn => {
          btn.addEventListener('click', () => {
            const userId = btn.getAttribute('data-user');
            showUserDetails(userId);
          });
        });
        
        // Add event listeners to delete buttons
        document.querySelectorAll('.delete-user').forEach(btn => {
          btn.addEventListener('click', () => {
            const userId = btn.getAttribute('data-user');
            showDeleteModal(userId);
          });
        });
      }
      
      async function blockUser(userId, block) {
        try {
          await db.collection("users").doc(userId).update({ 
            isBlocked: block 
          });
          showNotification(`User ${block ? "blocked" : "unblocked"} successfully`);
        } catch (error) {
          console.error("Error blocking user:", error);
          showNotification("Error updating user", false);
        }
      }
      
      function showUserDetails(userId) {
        const user = allUsers.find(u => u.id === userId);
        if (!user) return;
        
        // Remove any existing details panel
        document.querySelectorAll('.user-details-panel').forEach(panel => panel.remove());
        
        // Check if details panel already exists for this user
        const existingPanel = document.querySelector(`.user-details-panel[data-user="${userId}"]`);
        if (existingPanel) {
          existingPanel.remove();
          return;
        }
        
        const userItem = document.querySelector(`.view-details[data-user="${userId}"]`).closest('.user-item');
        
        const detailsPanel = document.createElement("div");
        detailsPanel.className = "user-details-panel";
        detailsPanel.setAttribute("data-user", userId);
        
        // Get country flag URL
        const flagUrl = user.country && user.country !== "Unknown" ? `https://flagcdn.com/w40/${user.country.toLowerCase()}.png` : '';
        
        // Calculate today's ad count and clicks
        const today = new Date().toDateString();
        const todayAds = user.adHistory ? user.adHistory.filter(ad => {
          const adDate = new Date(ad.date).toDateString();
          return adDate === today;
        }).length : 0;
        
        const todayClicks = user.adClickHistory ? user.adClickHistory.filter(click => {
          const clickDate = new Date(click.date).toDateString();
          return clickDate === today;
        }).length : 0;
        
        // Calculate total ad count and clicks
        const totalAds = user.adHistory ? user.adHistory.length : 0;
        const totalClicks = user.adClickHistory ? user.adClickHistory.length : 0;
        
        // Format activity log properly
        let activityLogHTML = '<p>No activity history</p>';
        if (user.activityLog && user.activityLog.length > 0) {
          activityLogHTML = `
            <table class="user-activity-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Activity</th>
                  <th>IP</th>
                  <th>Country</th>
                </tr>
              </thead>
              <tbody>
                ${user.activityLog.slice(-5).map(activity => `
                  <tr>
                    <td>${new Date(activity.date).toLocaleString()}</td>
                    <td><span class="activity-badge activity-${activity.type}">${activity.type}</span></td>
                    <td class="user-ip">${activity.ip || 'N/A'}</td>
                    <td>${activity.country && activity.country !== "Unknown" ? `<img src="https://flagcdn.com/w20/${activity.country.toLowerCase()}.png" class="flag-icon" alt="${activity.country}"> ${activity.country}` : 'N/A'}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          `;
        }
        
        detailsPanel.innerHTML = `
          <div class="user-details-header">
            <h4>User Details</h4>
            <span class="user-status ${user.isBlocked ? 'status-blocked' : 'status-active'}">
              ${user.isBlocked ? 'Blocked' : 'Active'}
            </span>
          </div>
          <div>
            <strong>Name:</strong> ${user.name}
          </div>
          <div>
            <strong>Username:</strong> @${user.username}
          </div>
          <div>
            <strong>User ID:</strong> ${user.userId}
          </div>
          <div>
            <strong>IP Address:</strong> <span class="user-ip">${user.ip}</span>
          </div>
          <div>
            <strong>Country:</strong> 
            ${user.country && user.country !== "Unknown" && flagUrl ? `<img src="${flagUrl}" class="flag-icon" alt="${user.country}"> ${user.country}` : 'N/A'}
          </div>
          <div>
            <strong>Ads Today:</strong> ${todayAds}/${dailyTaskLimit} watched, ${todayClicks} clicks
          </div>
          <div>
            <strong>Total Ads:</strong> ${totalAds} watched, ${totalClicks} clicks
          </div>
          <div>
            <strong>Balance:</strong> ৳${(user.balance || 0).toFixed(2)}
          </div>
          <div>
            <strong>Last Login:</strong> ${user.lastLogin ? new Date(user.lastLogin).toLocaleString() : 'N/A'}
          </div>
          <div>
            <strong>Registration Date:</strong> ${user.registrationDate ? new Date(user.registrationDate).toLocaleString() : 'N/A'}
          </div>
          
          <h4 style="margin-top: 15px;">Activity History</h4>
          ${activityLogHTML}
        `;
        
        userItem.appendChild(detailsPanel);
      }
      
      function renderWithdrawalMethods() {
        methodsList.innerHTML = "";
        
        if (withdrawalMethods.length === 0) {
          methodsList.innerHTML = "<div style='color: #666; padding: 10px; text-align: center;'>No methods added</div>";
          return;
        }
        
        withdrawalMethods.forEach((method, index) => {
          const methodItem = document.createElement("div");
          methodItem.className = "method-item";
          methodItem.innerHTML = `
            <div>
              <strong>${method.name}</strong>
            </div>
            <div class="method-controls">
              <label class="toggle-switch">
                <input type="checkbox" ${method.enabled ? 'checked' : ''} data-index="${index}">
                <span class="slider"></span>
              </label>
              <button class="action-btn delete remove-method" data-index="${index}">Remove</button>
            </div>
          `;
          
          methodsList.appendChild(methodItem);
        });
        
        // Add event listeners to toggle switches
        document.querySelectorAll('.toggle-switch input').forEach(switchEl => {
          switchEl.addEventListener('change', (e) => {
            const index = parseInt(e.target.getAttribute('data-index'));
            withdrawalMethods[index].enabled = e.target.checked;
          });
        });
        
        // Add event listeners to remove buttons
        document.querySelectorAll('.remove-method').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const index = parseInt(e.target.getAttribute('data-index'));
            withdrawalMethods.splice(index, 1);
            renderWithdrawalMethods();
          });
        });
      }
      
      function updateStats() {
        // Total users
        totalUsersEl.textContent = allUsers.length;
        
        // Active today (users who watched at least one ad today)
        const today = new Date().toDateString();
        const activeToday = allUsers.filter(user => {
          if (!user.adHistory) return false;
          return user.adHistory.some(ad => {
            const adDate = new Date(ad.date).toDateString();
            return adDate === today;
          });
        }).length;
        activeTodayEl.textContent = activeToday;
        
        // Total ads watched today
        let totalAdsToday = 0;
        allUsers.forEach(user => {
          if (user.adHistory) {
            const todayAds = user.adHistory.filter(ad => {
              const adDate = new Date(ad.date).toDateString();
              return adDate === today;
            }).length;
            totalAdsToday += todayAds;
          }
        });
        totalAdsTodayEl.textContent = totalAdsToday;
        
        // Total ad clicks today
        let totalClicksToday = 0;
        allUsers.forEach(user => {
          if (user.adClickHistory) {
            const todayClicks = user.adClickHistory.filter(click => {
              const clickDate = new Date(click.date).toDateString();
              return clickDate === today;
            }).length;
            totalClicksToday += todayClicks;
          }
        });
        totalClicksTodayEl.textContent = totalClicksToday;
        
        // Total withdrawals
        totalWithdrawalsEl.textContent = allRequests.length;
      }

      // Admin login
      adminLoginBtn.onclick = ()=>{
        const pass=document.getElementById("admin-password").value;
        if(pass==="eatt7242888"){
          isAdminLoggedIn = true;
          adminControls.classList.remove("hidden-section");
          adminLoginForm.classList.add("hidden-section");
          showNotification("✅ Admin logged in");
        } else {
          showNotification("❌ Wrong password",false);
        }
      };
      
      saveSettingsBtn.onclick = async ()=>{
        await saveSettings();
        showNotification("✅ Settings saved");
      };
      
      addMethodBtn.onclick = () => {
        const newMethodName = newMethodNameInput.value.trim();
        if (newMethodName) {
          withdrawalMethods.push({
            name: newMethodName,
            enabled: true
          });
          renderWithdrawalMethods();
          newMethodNameInput.value = "";
          showNotification("✅ Method added");
        }
      };

      // Country search functionality
      countrySearch.addEventListener("input", () => {
        renderCountryList();
      });
      
      // Tier filter functionality
      tierButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          tierButtons.forEach(b => b.classList.remove("selected"));
          btn.classList.add("selected");
          currentTierFilter = btn.dataset.tier;
          renderCountryList();
        });
      });
      
      // User search functionality
      userSearch.addEventListener("input", () => {
        renderUsersList();
      });

      // Initialize
      loadData();
    });
  </script>
</body>
</html>
